const RSMQPromise = require('rsmq-promise');
const logger = require('logger');

const rsmq = new RSMQPromise({
    host: "127.0.0.1", 
    port: 6379
});

/**
 * queue format is type_subscriber
 */
const queues = ['getartistdetails-handler', 'getartistdetails-spotifier', 'synclibrary-handler', 'synclibrary-spotifier'];

/**
 * setup queues
 */
queues.forEach((queue) => {
    logger.info('creating ' + queue + ' if not already exists.');
    rsmq.createQueue({qname: queue})
        .then((done) => {
            // nada
        })
        .catch((err) => {
            if (err.toString().toLowerCase().indexOf('queue exists') == -1)
                logger.error(err);
        });
});

module.exports = rsmq;